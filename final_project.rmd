---
title: "Final Project"
author: "S&DS 230/S&DS 530/ENV 757/PLSC 530"
subtitle: Due by 11:59am, Saturday, May 7, 2022
output:
  html_document: default
  word_document: default
  pdf_document: default
---

# Introduction: Background and Motivation

In this project, we will be looking at the effect of various factors on GDP per capita.

To do this, we will use the data from the World Bank (WDI) which includes yearly data across a variety of variables for 175 countries from 1970-2019. We are primarily interested in GDP per capita and our question of interest: among the variables selected for analysis, which ones have the greatest correlation with gdp per capita? We would also like to see how variables, such as the presence of armed conflict, relates to GDP per capita.

# Data Cleaning

## Variable Names and Descriptions

We have chosen to look at the following variables:

### Categorical variables:

- conflict | Shows whether the country is in an armed conflict with any other country
  - Value of 1 indicates conflict
  - Value of 0 indicates no conflict
- conflict_intensity | Shows the intensity of armed conflict in the country
  - Value of 0 indicates no conflict
  - Value of 1 indicates minor conflict
  - Value of 2 indicates major conflict
- conflict_type | Shows the type of conflict
  - Value of 0 indicates no conflict
  - Value of 1 indicates extrasystemic conflict
  - Value of 2 indicates interstate conflict
  - Value of 3 indicates intrastate conflict
  - Value of 4 indicates internationalized intrastate

### Continuous variables:

- gdppc: Gross domestic product per capita (in USD)
- trade_dependence: Total trade (imports + exports) as percentage of GDP
- v2x_polyarchy
  - Value from 0 - 1
  - Electoral democracy index where higher values == stronger democratic institutions
- v2x_rule
  - Value from 0 - 1
  - Rule of law index -- measures extent to which laws are fairly enforced -- higher values == stronger rule of law
- v2x_gender:
  - Value from 0 - 1
  - Women's political empowerment index -- higher values == greater political empowerment for women
- ka_open:
  - Value from 0 - 1
  - Measure of capital account openness -- higher values == greater integration with global financial markets

### Data cleaning process

To start, looking at the variables conflict", "conflict_intensity", and "conflict_type", these variables are categorical but are represented as numbers. We will convert these values to booleans/more descriptive values to make it easier to work with and understand the data.

```{r}
fdi$conflict <- as.logical(fdi$conflict)
fdi$conflict_intensity[fdi$conflict_intensity == 0] <- "None"
fdi$conflict_intensity[fdi$conflict_intensity == 1] <- "Minor"
fdi$conflict_intensity[fdi$conflict_intensity == 2] <- "Major"
fdi$conflict_type[fdi$conflict_type == 0] <- "No conflict"
fdi$conflict_type[fdi$conflict_type == 1] <- "Extrasystemic"
fdi$conflict_type[fdi$conflict_type == 2] <- "Interstate"
fdi$conflict_type[fdi$conflict_type == 3] <- "Intrastate"
fdi$conflict_type[fdi$conflict_type == 4] <- "Internationalized intrastate"
```

To further narrow down our data for this project, we will only be looking at data from countries in 2019.

```{r}
fdi_2019 <- fdi[fdi$year == 2019,]
dim(fdi_2019)
head(fdi_2019)
```

# Graphics

## Scatterplots

```{r}
# create scatterplot of gdp per capita vs. democracy index in 2019
plot(fdi_2019$gdppc, fdi_2019$v2x_polyarchy, xlab="GDP per capita", ylab="Democracy Index")
title("GDP per capita vs. Democracy Index in 2019")

# create scatterplot of gdp per capita vs. rule of law index in 2019
plot(fdi_2019$gdppc, fdi_2019$v2x_rule, xlab="GDP per capita", ylab="Rule of Law Index")
title("GDP per capita vs. Rule of Law Index in 2019")

# create scatterplot of gdp per capita vs. women's policital empowerment in 2019
plot(fdi_2019$gdppc, fdi_2019$v2x_gender, xlab="GDP per capita", ylab="Women's Political Empowerment Index")
title("GDP per capita vs. Women's Political Empowerment Index in 2019")

# create scatterplot of gdp per capita vs. measure of capital account openness

plot(fdi_2019$gdppc, fdi_2019$ka_open, xlab="GDP per capita", ylab="Capital Account Openness")
title("GDP per capita vs. Capital Account Openness in 2019")

```

This scatterplot does not convey a lot of useful information due to the outliers on the right side of the plot. To counteract this, we can replot this with the log of the GDP per capita.

```{r}
fdi_2019$log_gdppc <- log(fdi_2019$gdppc)
# create scatterplot of gdp per capita vs. democracy index in 2019
plot(fdi_2019$log_gdppc, fdi_2019$v2x_polyarchy, xlab="GDP per capita", ylab="Democracy Index")
title("Log of GDP per capita vs. Democracy Index in 2019")

# create scatterplot of gdp per capita vs. rule of law index in 2019
plot(fdi_2019$log_gdppc, fdi_2019$v2x_rule, xlab="GDP per capita", ylab="Rule of Law Index")
title("Log of GDP per capita vs. Rule of Law Index in 2019")

# create scatterplot of gdp per capita vs. women's policital empowerment in 2019
plot(fdi_2019$log_gdppc, fdi_2019$v2x_gender, xlab="GDP per capita", ylab="Women's Political Empowerment Index")
title("Log of GDP per capita vs. Women's Political Empowerment Index in 2019")

# create scatterplot of gdp per capita vs. measure of capital account openness
plot(fdi_2019$log_gdppc, fdi_2019$ka_open, xlab="GDP per capita", ylab="Capital Account Openness")
title("Log of GDP per capita vs. Capital Account Openness in 2019")
```

After logging the gdppc, it is a bit easier to see that there is a slight positive correlation with gdppc for the democracy index and the rule of law index. Plotting the GDP per capita with the women's empowerment index does not show a significant correlation in any way.

**3) Basic Tests** - t-test, correlation, AND ability to create bootstrap confidence interval for
either a t-test or a correlation.

# T-Test

Using a t-test, we analyzed if there was a difference in means between countries that were in armed conflict and those which were not. We found that there was a significant difference in means between the two variables.

```{r}
# Create a dataframe with just two columns for target variables
gddpc_ttest_data <- data.frame(fdi_2019$conflict, fdi_2019$gdppc)

# Remove rows with missing values in any column of data frame
gddpc_ttest_data<- gddpc_ttest_data[complete.cases(gddpc_ttest_data),]

colnames(gddpc_ttest_data) <- c("conflict", "gdppc")
(ttest <- t.test(gddpc_ttest_data$gdppc ~ gddpc_ttest_data$conflict, conf.level = .99))
```

Because the p-value is 0.000676, at an alpha of 0.05 we would conclude that there is a statistically significant difference in GDP per capita between countries that are currently in armed conflict and those that are not.

We then performed a bootstrapped 95% confidence interval:

```{r, echo=FALSE}
set.seed(230)

N <- 10000
bootstrapped_conflict <- rep(NA, N)
for (i in 1:N) {
  bootstrapped_conflict[i] <- mean(sample(gddpc_ttest_data$gdppc[gddpc_ttest_data$conflict == TRUE],
                   sum(gddpc_ttest_data$conflict == TRUE), replace = TRUE))
}
qLeft <- quantile(bootstrapped_conflict, c(0.025, 0.975))
paste0("The 95% bootstrapped confidence interval for GDP per capita of countries with armed conflict is (", qLeft[1], ", ", qLeft[2], ")")

bootstrapped_no_conflict <- rep(NA, N)
for (i in 1:N) {
  bootstrapped_no_conflict[i] <- mean(sample(gddpc_ttest_data$gdppc[gddpc_ttest_data$conflict == FALSE],
                   sum(gddpc_ttest_data$conflict == FALSE), replace = TRUE))
}
qRight <- quantile(bootstrapped_no_conflict, c(0.025, 0.975))
paste0("The 95% bootstrapped confidence interval for GDP per capita of countries with no armed conflict is (", qRight[1], ", ", qRight[2], ")")
```

We then created a histogram of the bootstrapped means of GDP per capita for countries with armed conflict and those without.

```{r, echo=FALSE}
hist(bootstrapped_conflict, main = "Bootstrapped Means of GDP per Capita (Armed Conflict)", xlab = "GDP per Capita", col = "red", breaks = 100)
abline(v = mean(bootstrapped_conflict), col = "red", lwd = 2)
abline(v = qLeft, col = "red", lwd = 2, lty = 2)
hist(bootstrapped_no_conflict, main = "Bootstrapped Means of GDP per Capita (No Conflict)", xlab = "GDP per Capita", col = "blue", breaks = 100)
abline(v = mean(bootstrapped_no_conflict), col = "blue", lwd = 2)
abline(v = qRight, col = "blue", lwd = 2, lty = 2)
```

The bootstrapped CIs and histograms indicate the same conclusion as the t-test, which is that there is a significant difference in GDP per Capita between countries that are in armed conflicts versus those that are not.

# Correlation

We chose to look at the correlation between FDI Per GDP and GDP Per Capita and found that out of the continuous indicator variables these had a weak correlation of 0.046.

```{r, echo = FALSE}
plot(jitter(fdi_2019$gdppc), jitter(fdi_2019$fdi_per_gdp), col = "green", xlab = "gdppc", ylab = "fdi_per_gdp")
mtext(paste("Correlation =", round(cor(fdi_2019$gdppc, fdi_2019$fdi_per_gdp, use = "complete.obs"), 3)), cex = 1.2, line = 0)
mtext("gdppc vs. fdi_per_gdp", cex = 1.2, line = 1)
abline(lm(fdi_2019$fdi_per_gdp ~ fdi_2019$gdppc), col = "orange")
```

```{r}
#Calculate the correlation between Conflict Intensity and GDP per Capita
(cor5 <- round(cor(fdi_2019$gdppc, fdi_2019$conflict_intensity, use = "pairwise.complete.obs"),3))
```


**4) Permutation Test** - include at least one.

```{r, echo=FALSE}
set.seed(230)

N <- 10000
diffvals <- rep(NA, N)
for (i in 1:N) {
  fakeconflict <- sample(gddpc_ttest_data$conflict)
  diffvals[i] <- mean(gddpc_ttest_data$gdppc[fakeconflict == TRUE]) -
    mean(gddpc_ttest_data$gdppc[fakeconflict == FALSE])
}

actualdiff <- mean(gddpc_ttest_data$gdppc[gddpc_ttest_data$conflict == TRUE])  -
  mean(gddpc_ttest_data$gdppc[gddpc_ttest_data$conflict == FALSE])

hist(diffvals,
     col = "yellow",
     main = "Permuted Sample Mean Diff in gdppc by Conflict Status",
     xlab = "Difference in gdppc",
     breaks = 50)
abline(v = actualdiff, col = "blue", lwd = 3)
text(actualdiff-.01, 300, paste("Actual Diff in Means =", round(actualdiff, 4)), srt = 90)

paste("P-value:", mean(abs(diffvals) >= abs(actualdiff)))
```

The permuted sample mean difference in gdppc by party group suggests that the difference in the sample mean is approximately 0. The p-value of 0.005 suggests that we reject the null hypothesis and conclude that the mean improvement in gdppc between groups is statistically significantly different.

**5) Multiple Regression** - use either backwards stepwise regression or some form of best
subsets regression. Should include residual plots. A GLM with a mix of continuous and
categorical predictors is fine here.

**6) AT LEAST ONE OF THE FOLLOWING TECHNIQUES** - ANOVA, ANCOVA, Logistic
Regression, Multinomial Regression, OR data scraping off a website.

```{r}
fdi_anova <- fdi_2019[c("gdppc", "conflict_intensity", "conflict_type")]
fdi_anova <- fdi_anova[complete.cases(fdi_anova),]

```

#### Conclusion and Summary
